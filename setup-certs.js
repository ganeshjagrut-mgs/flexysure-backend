#!/usr/bin/env node

/**
 * Script to convert base64 certificate to PEM format and extract private key
 */

const fs = require('fs');
const path = require('path');

// Base64 certificate data from your .env.local
const certBase64 = "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";

const certPassword = "BGVBsKNxzQwdgZmk";

console.log('üîß Setting up DMVIC client certificates...');

try {
  // Create certs directory
  const certsDir = path.join(__dirname, 'certs');
  if (!fs.existsSync(certsDir)) {
    fs.mkdirSync(certsDir, { recursive: true });
    console.log('‚úÖ Created certs directory');
  }

  // Write the base64 certificate to a .p12 file
  const p12Path = path.join(certsDir, 'dmvic-client.p12');
  const certBuffer = Buffer.from(certBase64, 'base64');
  fs.writeFileSync(p12Path, certBuffer);

} catch (error) {
  console.error('‚ùå Error setting up certificates:', error.message);
  process.exit(1);
}